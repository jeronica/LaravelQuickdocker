FROM local/nginx
MAINTAINER Jeronica

RUN apt-get update
RUN apt-get install sudo nano inetutils-ping

COPY Dockerfiles/configs/supervisor_nginx.conf /etc/supervisor/conf.d/
COPY laravel/ /var/www/app/

COPY Dockerfiles/configs/nginx-laravel.conf ${NGINX_CONF_DIR}/nginx.conf
COPY Dockerfiles/configs/app-laravel.conf ${NGINX_CONF_DIR}/sites-enabled/app.conf
COPY Dockerfiles/configs/www-nginx.conf /etc/php/7.1/fpm/pool.d/www.conf

WORKDIR /var/www/app/


RUN chown www-data storage/ -R
RUN chown www-data -R storage/
RUN mkdir logs
RUN chown www-data logs/ -R
RUN chown www-data -R logs/
RUN chmod 755 storage/ -R
RUN chmod 755 logs/ -R
RUN composer install
RUN php artisan horizon:install

EXPOSE 80 443

CMD ["/usr/bin/supervisord"]